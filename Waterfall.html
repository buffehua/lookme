<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>fall</title>

        <style>

        *{
            margin: 0 ;
            padding: 0;
            background-color: #333;
        }
        .container{
            position: relative;	
            width: 1200px;
            margin: 20px auto;
        }
        .container .box{
            display: flex;
            flex-direction: wrap;
            width: 178px;
            margin: 20px 0 30px ;
            padding: 5px 0 0 15px;
            float: left;
            overflow: hidden;		
        }
        .container .box .active{
            padding: 10px;
            border: 1px solid #cccccc;
            box-shadow: 0 0 5px #ccc;
            border-radius: 5px;
        }
        .container .box img{
            max-width: 100%;
        }
        .container .box h2{
            margin: 10px 0 0;
            padding: 0;
            font-size: 20px;
            color: white;
        }
        .container .box p{
            margin: 0;
            padding: 0 0 10px;
            font-size: 16px;
            color: floralwhite;
        }

        </style>
	</head>
	<body>
		<div id="container" class="container">
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
            <div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
            <div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
            <div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
            <div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
            <div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/350/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/100/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/160/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/170/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/500/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/200/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
			<div class="box">
				<div class="active">
					<img src="https://picsum.photos/200/400/?random=10">
					<h2>this is title</h2>
					<p>You just need to know what to look.</p>
				</div>
			</div>
		</div>

        <script>

window.onload=function(){
			//開始即呼叫
			waterfall('container','box')
			
			var dataInt = {
				"data": [
					{"src": '1.png'},{"src": '2.png'}, 
					{"src": '3.jpg'},{"src": '4.png'},
					{"src": '5.png'},{"src": '6.png'},
					{"src": '7.jpg'},{"src": '8.png'},
				]
			}
			
			//監聽滾動條事件
			window.onscroll=function(){
				//檢查是否具備了滾動條件
				if(checkScrollSlide){
					var ocontent = document.getElementById('container');
					//建立div，並將其加到所有box後面
					for(var i = 0; i < dataInt.data.length; i++) {
						var obox = document.createElement('div');
						obox.className = 'box';
						ocontent.appendChild(obox);
						var opic = document.createElement('div');
						opic.className = 'active';
						obox.appendChild(opic);
						var oimg = document.createElement('img');
						oimg.src = "img/" + dataInt.data[i].src;
						opic.appendChild(oimg);
						var oh=document.createElement('h2')
						oh.innerHTML='this is title'
						opic.appendChild(oh);
						var op=document.createElement('p')
						op.innerHTML='You just need to know what to look.'
						opic.appendChild(op)
					}
					waterfall('container', 'box');
				}
			}
		}
		
		function waterfall(content,box){
			//獲取大盒子（container）裡的所有小盒子（box）
			var ocontent=document.getElementById(content);
			var oboxs=getByClass(ocontent, box);
			//計算整個頁面顯示的列數(頁面寬/box的寬);
			var oboxW = oboxs[0].offsetWidth;
			//Math.floor 向下取整
			var cols = Math.floor(document.documentElement.clientWidth / oboxW);
			//設定container的寬度（這裡用剛剛計算出來的列數乘盒子的寬度（oboxW * cols）得到的）
			ocontent.style.cssText = 'width:' + oboxW * cols + 'px;margin:20 auto';
			var heightArr = [];
			for(var i = 0; i < oboxs.length; i++) {
				if(i < cols) {
					// 將前cols張圖片的寬度記錄到hArr陣列中(第一行的高度)
					heightArr.push(oboxs[i].offsetHeight);
				} else {
					//從第二行開始就開始找最小的高度了，決定帶插入圖片該插入到哪裡
					//js Math.min.apply()方法，取出陣列中的最小值
					var minH = Math.min.apply(null, heightArr);
					var index = getMinhIndex(heightArr, minH);
					// 設定最小高度的圖片的style為絕對定位，並設定top和left
					oboxs[i].style.position = 'absolute';
					oboxs[i].style.top = minH + 'px';
					oboxs[i].style.left = oboxs[index].offsetLeft+'px';
					heightArr[index] += oboxs[i].offsetHeight;
				}
			}
		}
		
		//返回所有的box盒子
		function getByClass(content, cName){
			var boxArr = new Array(),
				oElements = content.getElementsByTagName('*');
			for(var i = 0; i < oElements.length; i++) {
				if(oElements[i].className == cName) {
					boxArr.push(oElements[i]);
				}
			}
			return boxArr;
		}
		
		//獲取陣列中最小值的下標值
		function getMinhIndex(arr, val) {
			for(var i in arr) {
				if(arr[i] == val) {
					return i;
				}
			}
		}
		
		//定義函式檢測是否具備了滾動載入資料塊的條件
		function checkScrollSlide(){
			var ocontent = document.getElementById('container');
			var oboxs = getByClass(ocontent, 'box');
			//獲取最後一個box到頂部的距離+ 它自身一半的距離
			var lastboxH = oboxs[oboxs.length - 1].offsetTop + Math.floor(oboxs[oboxs.length - 1].offsetHeight / 2);
			//獲取滾動條滾動距離（為了消除標準模式和怪異模式之間的差別而做的相容）
			var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
			// 獲取window視覺化的高度
			var height = document.body.clientHeight || document.documentElement.clientHeight;
			return(lastboxH < scrollTop + height) ? true : false;
		}

        </script>
	</body>
</html>